<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="search" type="application/opensearchdescription+xml" title="MapillaryJS" href="/mapillary-js/opensearch.xml"><title data-react-helmet="true">Navigation Graph | MapillaryJS</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://mapillary.github.io/mapillary-js/docs/theory/navigation-graph"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Navigation Graph | MapillaryJS"><meta data-react-helmet="true" name="description" content="Graph Architecture and Data Flows"><meta data-react-helmet="true" property="og:description" content="Graph Architecture and Data Flows"><link data-react-helmet="true" rel="shortcut icon" href="/mapillary-js/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://mapillary.github.io/mapillary-js/docs/theory/navigation-graph"><link data-react-helmet="true" rel="alternate" href="https://mapillary.github.io/mapillary-js/docs/theory/navigation-graph" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://mapillary.github.io/mapillary-js/docs/theory/navigation-graph" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/mapillary-js/assets/css/styles.7bdd1c50.css">
<link rel="preload" href="/mapillary-js/assets/js/runtime~main.5ac90abc.js" as="script">
<link rel="preload" href="/mapillary-js/assets/js/main.8e27731d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/mapillary-js/"><img src="/mapillary-js/img/logo_green.svg" alt="MapillaryJS" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/mapillary-js/img/logo_green.svg" alt="MapillaryJS" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">MapillaryJS</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/mapillary-js/docs">Docs</a><a class="navbar__item navbar__link" href="/mapillary-js/api">API</a><a class="navbar__item navbar__link" href="/mapillary-js/examples">Examples</a><a href="https://github.com/mapillary/mapillary-js" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Getting Started</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Main Concepts</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Extension</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Theory</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/mapillary-js/docs/theory/theory">Theory</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/mapillary-js/docs/theory/coordinates">Coordinates</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mapillary-js/docs/theory/navigation-graph">Navigation</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/mapillary-js/docs/theory/polygon-triangulation">Triangulation</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Migration</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Navigation Graph</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="graph-architecture-and-data-flows"></a>Graph Architecture and Data Flows<a class="hash-link" href="#graph-architecture-and-data-flows" title="Direct link to heading">#</a></h2><p>When navigating in MapillaryJS, either by clicking on the map or on a navigation arrow in the viewer, the library gets a photo key to act upon. From the photo key we retrieve the data related to that key, like latitude, longitude and other properties, and create a node. The node is added to the graph.</p><p>With the node in the graph we have three tasks - showing the photo, the spatial arrows and the sequence arrows. These tasks are done in three different flows. These flows are shown in the diagram below. The green text indicates that a potential data request is done. Whenever the data needed is already cached, no request is made and the data is retrieved directly from the cache instead.</p><p>In the left-hand flow we retrieve the photo and the mesh used for 3D transitions. When both of these have been retrieved, the photo is shown in the viewer. This flow is independent of the other flows and their load times and therefore fast.</p><p>In the right-hand flow we retrieve the sequence data, determine the sequence edges and enable the sequence arrows accordingly.</p><p>The middle flow is a bit more involved and will be explained in more detail below. In short, we first retrieve tiles. Tiles are rectangular areas at different positions and sizes, distributed in a grid structure on the world map. We use <a href="https://s2geometry.io/" target="_blank" rel="noopener noreferrer">S2 cells</a> with a size of about 75 x 75 meters in MapillaryJS. Each tile contains photos distributed according to their GPS positions. After retrieving the tiles, spatial data for adjacent nodes is retrieved. Based on this, together with the sequence data from the right-hand flow, we compute spatial edges - the underlying data for displaying the respective spatial arrows that are shown in the viewer.</p><p><img alt="MapillaryJS 2.0 navigation graph architecture" src="/mapillary-js/assets/images/graph-diagram-89fca8df1c22906fa2f994b3e4bf862b.png"></p><p><em>Architecture of the MapillaryJS 2.0 navigation graph</em></p><p>The rest of this page focuses on the flow in the middle and how we determine the spatial edges.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="determining-the-spatial-edges"></a>Determining the Spatial Edges<a class="hash-link" href="#determining-the-spatial-edges" title="Direct link to heading">#</a></h2><p>The spatial edges flow starts with determining which tiles are needed for a certain node. Because the node has a GPS position, we know which tile it belongs to and can act accordingly. Also, because we run <a href="http://blog.mapillary.com/update/2014/12/15/sfm-preview.html" target="_blank" rel="noopener noreferrer">Structure from Motion</a>, we can make use of the improved computed GPS positions to make later calculations more accurate.</p><p>We retrieve tiles containing only basic node information like photo key, latitude and longitude to keep the amount of data low. For that reason we have to retrieve the spatial node data needed to determine good candidates for spatial edges at a later point in time.</p><p>We want to ensure that all the surrounding data that is needed for computing the edges in all directions is retrieved before doing any calculations. A bounding box with a side of 40 meters (dashed green square in the figure below) gives us every other node within at least 20 meters in all directions. When our node (the green dot in the figure) is in the middle of a tile (the black square) it is straightforward because all the other nodes in the bounding box will belong to the same tile and only that tile needs to be retrieved.</p><p><img alt="Node and bounding box within a tile" src="data:image/png;base64,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"></p><p><em>Our node of interest with its bounding box within a tile</em></p><p>When the node position is close to the boundary of the tile, a little more work is required. The bounding box will overlap multiple tiles (as seen in the next figure) and all of them need to be retrieved to ensure that all other nodes within the bounding box are available when computing the spatial edges.</p><p><img alt="Bounding box overlapping multiple tiles" src="data:image/png;base64,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"></p><p><em>A bounding box that overlaps multiple tiles</em></p><p>Let&#x27;s continue with the multiple tile example. When all the tiles have been retrieved, the other nodes within the bounding box (represented in the figure by the yellow dots) can be determined. For those nodes the spatial data required besides the geographic coordinates is retrieved. Mind that nodes are usually not uniformly distributed in the tiles but more densely populated along roads (e.g. let&#x27;s imagine that our example shows a large park).</p><p><img alt="Adjacent nodes within the bounding box" src="/mapillary-js/assets/images/graph-multiple-tiles-nodes-4ff6db73ad2c84c7cc5d954a28cce72e.png"></p><p><em>Adjacent nodes within the bounding box</em></p><p>Now that all the spatial data for the nodes in the bounding box has been retrieved, we can calculate the spatial edges and notify the render process to ensure that spatial arrows are shown. In this case we see four blue nodes that qualify as targets of edges from our source node. These nodes need to satisfy a number of constraints based on relative viewing direction, moving direction, and distance, among other things, to qualify as edge targets in a certain direction.</p><p><img alt="Adjacent nodes qualifying as edge targets" src="/mapillary-js/assets/images/graph-multiple-tiles-edges-7adb934a4b6d898b826ad010b01c7de1.png"></p><p><em>Adjacent nodes that qualify as edge targets in certain directions</em></p><p>Once the edges for our green source node have been determined, we also retrieve the data for the blue target nodes and determine <em>their</em> edges in the same way in a pre-caching algorithm to ensure that there is no or minimal loading time when navigating.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>The graph architecture was implemented to decrease load times by focusing on showing the photo as fast as possible, and independently creating the navigation arrows while loading less data.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/mapillary/mapillary-js/edit/main/doc/docs/theory/navigation-graph.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/mapillary-js/docs/theory/coordinates"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Coordinate Systems</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/mapillary-js/docs/theory/polygon-triangulation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Polygon Triangulation on the Sphere Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#graph-architecture-and-data-flows" class="table-of-contents__link">Graph Architecture and Data Flows</a></li><li><a href="#determining-the-spatial-edges" class="table-of-contents__link">Determining the Spatial Edges</a></li><li><a href="#summary" class="table-of-contents__link">Summary</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/mapillary-js/docs">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/mapillary-js/docs/main/guide">Main Concepts</a></li><li class="footer__item"><a class="footer__link-item" href="/mapillary-js/docs/extension/extend">Extension</a></li><li class="footer__item"><a class="footer__link-item" href="/mapillary-js/api">API Reference</a></li><li class="footer__item"><a class="footer__link-item" href="/mapillary-js/examples">Examples</a></li><li class="footer__item"><a class="footer__link-item" href="/mapillary-js/docs/theory/theory">Theory</a></li><li class="footer__item"><a class="footer__link-item" href="/mapillary-js/docs/migration/v4">Migration</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/mapillary/mapillary-js" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/data-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Data Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Cookie Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/mapillary-js/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/mapillary-js/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2024 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/mapillary-js/assets/js/runtime~main.5ac90abc.js"></script>
<script src="/mapillary-js/assets/js/main.8e27731d.js"></script>
</body>
</html>